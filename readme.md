# Spring Boot Registration Project

By Cleiton Balansin

## Introduction

This project was created to be used like a tutorial, you can follow the commits and see what was done in the code and the comments about writen in this file.

The main objective of this project is to bring together the various technologies accessible by SpringBoot.
The project starts as simple as possible, but over the commits new features will be added.
You will find comments and explanations of each topic in the sections "Tags and Commits" and "Tags", 

## Running

It's a Maven Project!
Commands:
- mvn clean compile - Clean and compile the project;
- mvn spring-boot:run - Run the application;
- This are related to multiple property files:
  - mvn clean package -Pdev - this will build with 'dev' profile
  - java -jar app.jar -Dspring.profiles.active=dev - this will run with 'dev' profile


### The project: Registration

This project has the functionality to store data of any type. You can store data about a "Person" or a "Car" or a "Dog". For this you must create entities that will define the data saved by each type of register ("Person", "Car" or "Dog") you want.

## Tags, Commits and comments about


- 100_initial
  - First commit - project made by spring-initializr - no changes
  - Files from spring-initializr - original zip and configuration used
    - The first two commits are related to project generated by spring-initializr (https://start.spring.io/). The original project generated, the original zip file and an image from the site with the configuration used to generate this project.
  - The readme.md file
    - Contains the firsts topics: "Introduction", "running", "the project", "commits" and "tags".
- 101_first_endpoint
  - the first endpoint returns the datetime of server
- 102_spring_actuator
  - Change /time to return an ISO-8601 representation of date
    - This is a easier way to represent datetime in a string, a javascript code, for example, can turn it into a date object very easy.
  - Added actuator dependency
  - Change the port of actuator management server
    - we change application.properties file defining the server port and the management server port
  - Enable all of actuator endpoints by properties file - Change the default discovery endpoint /actuator to /act by properties file
  - Added git informations into /act/info endpoint of actuator
  - Added maven build informations into /act/info endpoint of actuator
  - Change the exposure of actuator's endpoints to expose only info,health,metrics
- 103_h2database
  - Rename main class SpringbootRegistrationApplication and readme.md modifications
  - Create method run() with CommandLineRunner interface
  - Import H2 and make a method to access (insert and query) relational data using JDBC
- 104_Logging
  - Change the sout for Logger.info (slf4j)
  - Logging the exception in case of problem in database operations
  - Create logback configuration file logback.xml, log in console with level info
  - Adding config to log into files, SizeAndTimeBasedRollingPolicy will create files with 1mb max
  - Remove the code that generates logs
- 105_Properties_files
  - Added property to change the format of return from /time
  - Change 1 application.properties to 3 files, more dev and prod, prod is default
  - Change configuration of properties, change default profile from pom.xml to application.properties


## Tags

### 100_initial - Initial project

The initial project has only two dependencies: 
- "spring-boot-starter-web" (this one make your java project into a web java project),
- "spring-boot-starter-test" (and this adds into your project the possibility to use tests, and a class SpringbootRegistrationApplicationTests already exists in the initial project).

Besides the dependencies we have the plugin:
- "spring-boot-maven-plugin" (this one allows we use spring-boot commands in maven).

We need run "mvn clean compile" to compile the project and "mvn spring-boot:run" to run the application. After that, you can access the application in the browser: http://localhost:8080/. "Whitelabel Error Page" must appear because we still haven't defined anything, but the Tomcat server is running.

### 101_newtag - The first endpoint

The class **TimeController** contains two annotations: RestController (https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/RestController.html)
and GetMapping (https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/GetMapping.html).

**RestController** is a specialized version of the controller. It includes the @Controller and @ResponseBody annotations, and as a result, simplifies the controller implementation (https://www.baeldung.com/spring-controller-vs-restcontroller).

**GetMapping** annotation is a specialized version of @RequestMapping annotation that acts as a shortcut for @RequestMapping(method = RequestMethod.GET) (https://howtodoinjava.com/spring5/webmvc/controller-getmapping-postmapping/).

Now, after running the application, it is possible to access the address http://localhost:8080/time and see something like: _Wed Nov 16 00:38:37 BRST 2022_ (result of the line "new Date().toString()" in the method "public String time()").


### 102_spring_actuator

Spring Boot's Actuator dependency is used to monitor and manage the Spring web application.
Actuator is mainly used to expose operational information about the running application â€” health, metrics, info, dump, env, etc. It uses HTTP endpoints or JMX beans to enable us to interact with it (https://www.baeldung.com/spring-boot-actuators).
Now, after running the application, it is possible to access the address http://localhost:9001/actuator/health, for example, to see the status of the server ("UP" is expected).

Actuator can respond in different port than the application, for that we change application.properties file.

We change the default endpoint to http://localhost:9001/act and enable all the endpoints of actuator changing the properties "management.endpoints.web.exposure.include" and "management.endpoints.web.base-path".

Now we can access git informations in http://localhost:9001/act/info endpoint thanks to "git-commit-id-plugin" plugin.
Also we can access maven build informations thanks to "spring-boot-maven-plugin" plugin, here we must define a "goal" in the pom file (< goal>build-info</ goal>).

We also change the exposure of actuator's endpoints to expose only info,health,metrics by setting "management.endpoints.web.exposure.include" property, in the same way we can change "management.endpoints.web.exposure.exclude" property, but with the names of endpoints we want to exclude!

### 103_h2database

First we created the method run() using CommandLineRunner interface: Used to indicate that a bean should run when it is contained within a SpringApplication. (https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/CommandLineRunner.html).

Now we want the H2 database working on the project, after we will use this for something.
We added the dependencies for H2 and "spring-boot-starter-jdbc" and all configuration is automatic in Spring Boot for H2, because of that we don't need create configurations like url connection, user, password, etc. We need only inject the object JdbcTemplate.
In SpringbootRegistrationApplication.run() was implemented all tasks related to the database: drop table, create table, insert records, query.
The object Car was created to make this tasks possible, see the packages created? we try start some clean architecture here.

### 104_Logging

It's very simple to use Logger. Import org.slf4j.Logger and create the object with LoggerFactory.getLogger(), after that we can use Logger.info() and anothers methods to log. Messages must be meaningful and always remember to log the exception.
We can configurate the log, here we put the file logback.xml to log into console with info level.
RollingFileAppender and SizeAndTimeBasedRollingPolicy are used to config the logs into files, files max 1mb in size, 30 days and 1gb max storage.

### 105_Properties_files

You can create every property you want, Spring Boot keeps it simple and everything you need to do is write it in "application.properties" file, and in the code get the value with "env.getProperty()" method.

We created two more property files: application-dev.properties and application-prod.properties. We moved the content of aplication.properties to these files and we change a little to show some difference when one or another runs. Prod start the server in 8080 port. Dev start the server in 8081 port.
**Important**: For this was created the tag "profiles" in pom.xml, and we can change wich file runs in the tag "activeByDefault"! Alternatively, the profile can be directly specified in the application.properties file by adding the line: spring.profiles.active=prod

We changed the format of setting the default profile from pom.xml to application.properties. This will help during the development, but previous configuration is nicer.